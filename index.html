<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="app.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css">
  <title>Web Test</title>
</head>

<body>
  <div style="margin-left: 50px;">
    <div class="row">
      <img src="https://i.pinimg.com/originals/67/0b/bc/670bbc8b2507d5f2f0b32f73224e972a.gif" width="250"/>
    </div>
    <div class="row" style="margin-top: 50px;">
      <label>Data send</label>
      <input type="text" name="txtSend" id="txtSend" placeholder="">
    </div>
    <div class="row">
      <button id="btnSendData" onclick="handleSendData(1)">Google</button>
      <button id="btnSendData" onclick="handleSendData(2)">Apple</button>
      <button id="btnSendData" onclick="handleSendData(3)">Biometric</button>
    </div>
    <div class="row" style="margin-top: 50px;">
      <div style="margin-top: 20px;">
        <div>
          <label>User</label>
          <input type="text" name="txtUser" id="txtUser" value="devfsoft06">
        </div>
        <div>
          <label>Tieu de</label>
          <input type="text" name="txtTitle" id="txtTitle" value="Tieu de">
        </div>
        <div>
          <label>Noi dung</label>
          <input type="text" name="txtContent" id="txtContent" value="Noi dung:_1">
        </div>
      </div>
      <div class="column" style="margin-top: 20px;">
        <button id="btnSendData" onclick="readFireStore()">Read FireStore</button>
        <button id="btnSendData" onclick="sendMessage()">Send Message</button>
      </div>
    </div>
    <div class="row" style="margin-top: 50px; margin-bottom: 50px;">
      <div style="margin-top: 20px;">
        <div>
          <label>User</label>
          <input type="text" name="txtUserFirestore" id="txtUserFirestore" value="devfsoft06">
        </div>
        <div>
          <label>Device</label>
          <select id="txtDevice">
            <option value=1>nixphone</option>
            <option value=2>readmi</option>
            <option value=3>pixel</option>
          </select>
        </div>
      </div>
      <div class="column" style="margin-top: 20px;">
        <button id="btnUpdateData" onclick="updateFireStore()">Update data</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  document.addEventListener("message ", (event) => {
    console.log("====================================document.addEventListener ");
    console.log(event);
    console.log("====================================");
  });

  window.addEventListener(" message ", (event) => {
    console.log("====================================window.addEventListener ");
    console.log(event);
    console.log("====================================");
  });

  function handleSendData(type) {
    console.info('---> handleSendData')
    let channel = '';
    switch (type) {
      case 1:
        channel = 'google_login';
        break;
      case 2:
        channel = 'apple_login';
        break;
      case 3:
        channel = 'biometric_login';
        break;
    
      default:
        channel = 'google_login';
        break;
    }

    console.info('channel ', channel)
    
    if (window.ReactNativeWebView) {
      window.ReactNativeWebView.postMessage(
        JSON.stringify({
          channel: channel,
        })
      );
    }
    
    document.getElementById("txtSend").value = JSON.stringify(channel);
  }

  async function readFireStore (){
    try {
      const data = await axios.get('http://localhost:4002/expo-test-336102/us-central1/app/api/v1/read-firestore')
      // const send = await axios.post('https://us-central1-expo-test-336102.cloudfunctions.net/api/update-notify-status', data)
      // const send = await axios.get("http://localhost:3003/read-firestore")
      console.log('==================================== readFireStore');
      console.log(data);
      console.log('====================================');
    } catch (e) {
      console.error(e)
    }
  }

  async function updateFireStore (){
    try {
      
      let data = {
        user: 'devfsoft06',
        fieldName: '',
        devicePush: '',
        expoPush: ''
      };

      const type = parseInt(document.getElementById("txtDevice").value);
      if (type === 1){
        data.fieldName = 'nixphone';
        data.devicePush = '90f0d83c2576727eea7816b3a153741de321cf362cabb14721c409de8a87cc15';
        data.expoPush = 'ExponentPushToken[gh3ouKEdYC3FqRVn3P4cFa]';
      } else if (type === 2) {
        data.fieldName = 'M2101K7AG';
        data.devicePush = "fd4EkXKvTeWQZWF3teMef3:APA91bHsxtJ9pvG3ejPaL8zb8Mc7iu3Svgy7iAAEnCCjtVMDaBK_RNvzr_lLGBj429z9ep4Sn8Q_69VpququjG1BkNFUB1yK--R-lXrcLtHRRsqO1-0IUwQX91PZSEu__lUeJN7-4r6d";
        data.expoPush = 'ExponentPushToken[D8vK34DV1kcsv3qfgNacg-]'; 
      } else {
        data.fieldName = 'Pixel 2';
        data.devicePush = "d69GwBALRO-BtfzEdpSvJr:APA91bEOo3NwU_OEt1a6YI3L_jqP64qpzCkImKnJ1r7rR49ChXiQkESaCzTEuQ_qaIOzUDymFJv8ta_TVbWsj69Gua-rda2N_o_L1GfrZIslL33LcO0G7RTkTRLQTxdvmnM-pksM3k9S";
        data.expoPush = 'ExponentPushToken[AKr900CpRjk0xp-3g-FoPS]'; 
      }

      const send = await axios.post('http://localhost:4002/expo-test-336102/us-central1/app/api/v1/write-firestore', data)
      // const send = await axios.post('https://us-central1-expo-test-336102.cloudfunctions.net/app/api/v1/write-firestore', data)
      console.log('==================================== updateFireStore');
      console.log(send);
      console.log('====================================');
    } catch (e) {
      console.error(e)
    }
  }

  async function sendMessage (){
    try {
      const data = {
        user: document.getElementById("txtUser").value,
        title: document.getElementById("txtTitle").value,
        content: document.getElementById("txtContent").value
      }

      // const send = await axios.post('http://localhost:4002/expo-test-336102/us-central1/app/api/v1/push-notify', data)
      // const send = await axios.post('https://us-central1-expo-test-336102.cloudfunctions.net/app/api/v1/push-notify', data)
      const send = await axios.post('http://localhost:3003/push-notify', data)
      console.log("ðŸš€ ~ file: index.html ~ line 111 ~ sendMessage ~ send", send)
      if (send && send.status === 200){
        const title = document.getElementById("txtContent").value;
        const index = title.indexOf(':_');
        const num = title.substring(index + 2, index + 3);
        const val = title.replace(num, (parseInt(num) + 1).toString());
        document.getElementById("txtContent").value = val;
      }
    } catch (e) {
      console.error(e)
    }
  }
</script>

</body>
</html>